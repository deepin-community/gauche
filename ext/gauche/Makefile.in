srcdir       = @srcdir@
builddir     = @builddir@
top_builddir = @top_builddir@
top_srcdir   = @top_srcdir@

SCM_CATEGORY = gauche

include ../Makefile.ext

LIBFILES = gauche--collection.$(SOEXT) \
	   gauche--sequence.$(SOEXT)   \
	   gauche--dictionary.$(SOEXT)   \
	   gauche--parameter.$(SOEXT)  \
	   gauche--process.$(SOEXT) \
	   gauche--hook.$(SOEXT) \
	   gauche--record.$(SOEXT) \
	   gauche--generator.$(SOEXT) \
	   gauche--unicode.$(SOEXT) \
	   gauche--bitvector.$(SOEXT) \
	   gauche--atomic.$(SOEXT)
SCMFILES = collection.sci \
	   sequence.sci   \
	   dictionary.sci \
	   parameter.sci  \
	   process.sci \
	   hook.sci \
	   record.sci \
	   generator.sci \
	   unicode.sci \
	   bitvector.sci \
	   atomic.sci

CONFIG_GENERATED = Makefile
PREGENERATED = unicode-attr.scm
XCLEANFILES = *.c $(SCMFILES)

all : $(LIBFILES)

OBJECTS = $(gauche-collection_OBJECTS) \
	  $(gauche-sequence_OBJECTS) \
	  $(gauche-dictionary_OBJECTS) \
	  $(gauche-parameter_OBJECTS) \
	  $(gauche-process_OBJECTS) \
	  $(gauche-hook_OBJECTS) \
	  $(gauche-record_OBJECTS) \
	  $(gauche-generator_OBJECTS) \
	  $(gauche-unicode_OBJECTS) \
	  $(gauche-bitvector_OBJECTS) \
	  $(gauche-atomic_OBJECTS)

# gauche.collection
gauche-collection_OBJECTS = gauche--collection.$(OBJEXT)

gauche--collection.$(SOEXT) : $(gauche-collection_OBJECTS)
	$(MODLINK) gauche--collection.$(SOEXT) $(gauche-collection_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--collection.c collection.sci : $(top_srcdir)/libsrc/gauche/collection.scm
	$(PRECOMP) -e -P -o gauche--collection $(top_srcdir)/libsrc/gauche/collection.scm


# gauche.sequence
gauche-sequence_OBJECTS = gauche--sequence.$(OBJEXT)

gauche--sequence.$(SOEXT) : $(gauche-sequence_OBJECTS)
	$(MODLINK) gauche--sequence.$(SOEXT) $(gauche-sequence_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--sequence.c sequence.sci : $(top_srcdir)/libsrc/gauche/sequence.scm
	$(PRECOMP) -e -P -o gauche--sequence $(top_srcdir)/libsrc/gauche/sequence.scm


# gauche.dictionary
gauche-dictionary_OBJECTS = gauche--dictionary.$(OBJEXT)

gauche--dictionary.$(SOEXT) : $(gauche-dictionary_OBJECTS)
	$(MODLINK) gauche--dictionary.$(SOEXT) $(gauche-dictionary_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--dictionary.c dictionary.sci : $(top_srcdir)/libsrc/gauche/dictionary.scm
	$(PRECOMP) -e -P -o gauche--dictionary $(top_srcdir)/libsrc/gauche/dictionary.scm


# gauche.parameter
gauche-parameter_OBJECTS = gauche--parameter.$(OBJEXT)

gauche--parameter.$(SOEXT) : $(gauche-parameter_OBJECTS)
	$(MODLINK) gauche--parameter.$(SOEXT) $(gauche-parameter_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--parameter.c parameter.sci : $(top_srcdir)/libsrc/gauche/parameter.scm
	$(PRECOMP) -e -P -o gauche--parameter $(top_srcdir)/libsrc/gauche/parameter.scm

# gauche.process
gauche-process_OBJECTS = gauche--process.$(OBJEXT)

gauche--process.$(SOEXT) : $(gauche-process_OBJECTS)
	$(MODLINK) gauche--process.$(SOEXT) $(gauche-process_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--process.c process.sci : $(top_srcdir)/libsrc/gauche/process.scm
	$(PRECOMP) -e -P -o gauche--process $(top_srcdir)/libsrc/gauche/process.scm

# gauche.hook
gauche-hook_OBJECTS = gauche--hook.$(OBJEXT)

gauche--hook.$(SOEXT) : $(gauche-hook_OBJECTS)
	$(MODLINK) gauche--hook.$(SOEXT) $(gauche-hook_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--hook.c hook.sci : $(top_srcdir)/libsrc/gauche/hook.scm
	$(PRECOMP) -e -P -o gauche--hook $(top_srcdir)/libsrc/gauche/hook.scm

# gauche.record
# TRANSIENT: Use --omit-debug-source-info to suppress the size of generated
# .c file for memory-tight machines.
gauche-record_OBJECTS = gauche--record.$(OBJEXT)

gauche--record.$(SOEXT) : $(gauche-record_OBJECTS)
	$(MODLINK) gauche--record.$(SOEXT) $(gauche-record_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--record.c record.sci : $(top_srcdir)/libsrc/gauche/record.scm
	$(PRECOMP) -e -P --omit-debug-source-info -o gauche--record $(top_srcdir)/libsrc/gauche/record.scm

# gauche.generator
gauche-generator_OBJECTS = gauche--generator.$(OBJEXT)

gauche--generator.$(SOEXT) : $(gauche-generator_OBJECTS)
	$(MODLINK) gauche--generator.$(SOEXT) $(gauche-generator_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--generator.c generator.sci : $(top_srcdir)/libsrc/gauche/generator.scm
	$(PRECOMP) -e -P -o gauche--generator $(top_srcdir)/libsrc/gauche/generator.scm

# gauche.unicode
#  NB: unicode_attr.h and unicode-attr.scm are generated by gen-unicode.scm,
#  with 'make' in src/.

gauche-unicode_OBJECTS = gauche--unicode.$(OBJEXT)

gauche--unicode.$(SOEXT) : $(gauche-unicode_OBJECTS)
	$(MODLINK) gauche--unicode.$(SOEXT) $(gauche-unicode_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--unicode.c unicode.sci : unicode.scm unicode-attr.scm
	$(PRECOMP) -I $(builddir) -e -P -o gauche--unicode $(srcdir)/unicode.scm

gauche--unicode.$(OBJEXT) : gauche--unicode.c $(top_builddir)/src/gauche/priv/unicode_attr.h

unicode-attr.scm : $(top_srcdir)/src/gen-unicode.scm $(top_srcdir)/src/unicode-data.scm

# gauche.bitvector

gauche-bitvector_OBJECTS = gauche--bitvector.$(OBJEXT)

gauche--bitvector.$(SOEXT) : $(gauche-bitvector_OBJECTS)
	$(MODLINK) gauche--bitvector.$(SOEXT) $(gauche-bitvector_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--bitvector.c bitvector.sci : bitvector.scm
	$(PRECOMP) -I $(builddir) -e -P -o gauche--bitvector $(srcdir)/bitvector.scm

# gauche.atomic

gauche-atomic_OBJECTS = gauche--atomic.$(OBJEXT)

gauche--atomic.$(SOEXT) : $(gauche-atomic_OBJECTS)
	$(MODLINK) gauche--atomic.$(SOEXT) $(gauche-atomic_OBJECTS) $(EXT_LIBGAUCHE) $(LIBS)

gauche--atomic.c atomic.sci : atomic.scm
	$(PRECOMP) -I $(builddir) -e -P -o gauche--atomic $(srcdir)/atomic.scm

install : install-std
